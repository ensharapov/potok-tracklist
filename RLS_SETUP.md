# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Row Level Security (RLS) –≤ Supabase

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

Supabase –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `user_progress` –ø—É–±–ª–∏—á–Ω–∞, –Ω–æ RLS –æ—Ç–∫–ª—é—á–µ–Ω. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª—é–±–æ–π, –∫—Ç–æ –∑–Ω–∞–µ—Ç URL –∏ `ANON_KEY`, –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–í–∫–ª—é—á–∞–µ–º RLS –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **Service Role Key** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ Vercel serverless functions). Service Role Key –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ö–æ–¥–∏—Ç RLS, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—à–µ–º—É API —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –∑–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API.

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase

1. –û—Ç–∫—Ä–æ–π **Supabase Dashboard** ‚Üí **SQL Editor**
2. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `supabase-enable-rls.sql` –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ
3. –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å SQL –∫–æ–¥
4. –í—Å—Ç–∞–≤—å –≤ SQL Editor
5. –ù–∞–∂–º–∏ **Run** (–∏–ª–∏ F5)
6. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Success. No rows returned"

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:**
- –í–∫–ª—é—á–∞–µ—Ç Row Level Security (RLS) –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `user_progress`
- –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª–∏—Ç–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ Service Role

---

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å Service Role Key

1. –í **Supabase Dashboard** –ø–µ—Ä–µ–π–¥–∏ –≤ **Settings** ‚Üí **API**
2. –ù–∞–π–¥–∏ —Å–µ–∫—Ü–∏—é **Project API keys**
3. –°–∫–æ–ø–∏—Ä—É–π –∫–ª—é—á **`service_role`** (‚ö†Ô∏è **–ù–ï** `anon`!)
   - –≠—Ç–æ –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –Ω–∞—á–∏–Ω–∞—é—â–∞—è—Å—è —Å `eyJ...`
   - ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç –∫–ª—é—á –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π –µ–≥–æ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ!

---

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

1. –û—Ç–∫—Ä–æ–π **Vercel Dashboard** ‚Üí —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí **Settings** ‚Üí **Environment Variables**
2. –ù–∞–∂–º–∏ **Add New**
3. –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Key**: `SUPABASE_SERVICE_ROLE_KEY`
   - **Value**: (–≤—Å—Ç–∞–≤—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `service_role` –∫–ª—é—á)
   - **Environment**: –≤—ã–±–µ—Ä–∏ –≤—Å–µ —Ç—Ä–∏ (Production, Preview, Development)
4. –ù–∞–∂–º–∏ **Save**

**‚ö†Ô∏è –í–∞–∂–Ω–æ:**
- –ù–µ –¥–æ–±–∞–≤–ª—è–π —ç—Ç–æ—Ç –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –æ–Ω –≤ git)
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –≤ Vercel Environment Variables
- Service Role Key –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ serverless functions)

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω

–ö–æ–¥ –≤ `api/progress-supabase.ts` —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
1. –°–Ω–∞—á–∞–ª–∞ `SUPABASE_SERVICE_ROLE_KEY` (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
2. –ü–æ—Ç–æ–º `SUPABASE_ANON_KEY` (–∫–∞–∫ fallback)
3. –ü–æ—Ç–æ–º `VITE_SUPABASE_ANON_KEY` (–∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π fallback)

---

### –®–∞–≥ 5: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

1. –í **Vercel Dashboard** –ø–µ—Ä–µ–π–¥–∏ –≤ **Deployments**
2. –ù–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
3. –ù–∞–∂–º–∏ **Redeploy** (–∏–ª–∏ —Å–¥–µ–ª–∞–π –Ω–æ–≤—ã–π –∫–æ–º–º–∏—Ç –∏ push)
4. –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
2. –û—Ç–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–∫–±–æ–∫—Å–æ–≤
3. –ù–∞–∂–º–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å X%"
4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ Vercel:
   - **Vercel Dashboard** ‚Üí **Functions** ‚Üí `/api/progress-supabase` ‚Üí **Logs**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏—Å—á–µ–∑–ª–æ:
   - **Supabase Dashboard** ‚Üí **Table Editor** ‚Üí `user_progress`
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "RLS Disabled in Public" –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

**–î–æ:**
- RLS –æ—Ç–∫–ª—é—á–µ–Ω
- –õ—é–±–æ–π —Å `ANON_KEY` –º–æ–≥ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ö†Ô∏è –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ

**–ü–æ—Å–ª–µ:**
- RLS –≤–∫–ª—é—á–µ–Ω
- `ANON_KEY` –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ç–∞–±–ª–∏—Ü–µ
- –¢–æ–ª—å–∫–æ Service Role Key (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ) –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ

### –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:

1. **Service Role Key** ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Vercel serverless functions)
2. **ANON_KEY** ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–Ω–æ –æ–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ RLS)
3. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π Service Role Key –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ –∏–ª–∏ –≤ git

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û—à–∏–±–∫–∞: "new row violates row-level security policy"

**–ü—Ä–∏—á–∏–Ω–∞:** RLS –≤–∫–ª—é—á–µ–Ω, –Ω–æ Service Role Key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `SUPABASE_SERVICE_ROLE_KEY` –¥–æ–±–∞–≤–ª–µ–Ω –≤ Vercel Environment Variables
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞: "Database not configured"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Vercel
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Production/Preview/Development)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)
- [Service Role Key vs Anon Key](https://supabase.com/docs/guides/api/api-keys)


